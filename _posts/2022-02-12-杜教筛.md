---
layout: post
title: 杜教筛
subtitle: 
categories: 数学
tags: [数论分块,筛法]
---

我们对于一个要求的数论函数 $f(x)$,定义 $S(n)=\sum_{i=1}^nf(x)$ 

然后我们考虑构造一个 $S(n)$ 关于 $S(\lfloor\frac{n}{i}\rfloor)$ 的一个递推式子。

我们发现，对于任意的一个数论函数 $g(x)$ ,我们有：

$$\sum_{i=1}^{n}\sum_{d\mid i}g(d)f(\frac{i}{d})=\sum_{i=1}^n(g\times f)(i)$$

然后我们考虑先枚举 $d$

$$=\sum_{d=1}^{n}\sum_{k=1}^{kd\le n}g(d)f(\frac{kd}{d})$$

$$=\sum_{d=1}^{n}\sum_{k=1}^{\lfloor\frac{n}{d}\rfloor}g(d)f(k)$$

$$=\sum_{d=1}^{n}g(d)S(\lfloor\frac{n}{d}\rfloor)$$

所以由上面的式子，可以得到一个杜教筛的核心公式:

$$g(1)S(n)=\sum_{i=1}^{n}(f\times g)(i)-\sum_{i=2}^{n}g(i)S(\lfloor\frac{n}{i}\rfloor)$$

这样我们就可以求一些数论函数的前缀和了。

我们举两个例子：一个 $\mu$ 一个 $\varphi$

我们先以 $\mu$ 为例。

因为 $\mu \times 1=e$,我们把 $f$ 代入 $\mu$ , 把 $g$ 代入 $1$,可得：

$$S(n)=\sum_{i=1}^{n}e(i)-\sum_{i=2}^{n}S(\lfloor\frac{n}{i}\rfloor)$$

$$=1-\sum_{i=2}^nS(\lfloor\frac{n}{i}\rfloor)$$

然后 $\varphi$ 同理可以由 $\varphi\times1=id$ 得到:

$$S(n)=\sum_{i}^{n}id(i)-\sum_{i=2}^nS(\lfloor\frac{n}{i}\rfloor)$$

$$S(n)=\frac{(n+1)n}{2}-\sum_{i=2}^nS(\lfloor\frac{n}{i}\rfloor)$$

但是同时，我们还可以用莫比乌斯反演，以达到只需 $\mu$ 的前缀和即可。

$$S(n)=\frac{1}{2}(\sum_{i=1}^n\mu(i)\lfloor\frac{n}{i}\rfloor^2-1)+1$$